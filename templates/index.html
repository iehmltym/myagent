<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ—å¿—ç²ä»Šæ—¥å€¼ç­AIå°åŠ©æ‰‹</title>
  <style>
    :root {
      --bg: #fff7ff;
      --card: rgba(255, 255, 255, 0.9);
      --primary: #ff7ad9;
      --primary-dark: #f04ebf;
      --secondary: #7c5cff;
      --accent: #48d1ff;
      --text: #2a1747;
      --muted: #7a6a91;
      --border: rgba(255, 255, 255, 0.6);
      --shadow: 0 18px 40px rgba(255, 122, 217, 0.18);
      --radius: 22px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Segoe UI", system-ui, -apple-system, "PingFang SC", "Microsoft YaHei", Arial;
      background: radial-gradient(circle at top, #ffe9fb 0%, #f7f3ff 45%, #edf7ff 100%);
      color: var(--text);
    }

    .wrap {
      max-width: 1120px;
      margin: 40px auto;
      padding: 0 16px 60px;
      position: relative;
      z-index: 1;
    }

    .bg-blobs {
      position: fixed;
      inset: 0;
      overflow: hidden;
      z-index: 0;
      pointer-events: none;
    }

    .blob {
      position: absolute;
      width: 320px;
      height: 320px;
      border-radius: 50%;
      filter: blur(10px);
      opacity: 0.5;
      animation: float 10s ease-in-out infinite;
    }

    .blob.one { background: #ffd6f5; top: -60px; left: -60px; }
    .blob.two { background: #d7f1ff; top: 120px; right: -80px; animation-delay: -2s; }
    .blob.three { background: #fce6c4; bottom: -120px; left: 20%; animation-delay: -4s; }

    @keyframes float {
      0%, 100% { transform: translateY(0px) translateX(0px); }
      50% { transform: translateY(20px) translateX(10px); }
    }

    .hero {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 228, 247, 0.85) 50%, rgba(226, 240, 255, 0.9) 100%);
      border: 1px solid rgba(255, 255, 255, 0.7);
      border-radius: var(--radius);
      padding: 28px 24px 24px;
      box-shadow: var(--shadow);
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.8fr);
      gap: 18px;
    }

    .hero h1 {
      margin: 0 0 8px;
      font-size: 30px;
    }

    .hero p {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
    }

    .card {
      margin-top: 20px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }

    .hero-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .hero-tags .tag.emphasis {
      background: rgba(124, 92, 255, 0.15);
      color: var(--secondary);
    }

    .tag {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(255, 122, 217, 0.2);
      color: var(--secondary);
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    .hero-art {
      background: rgba(255, 255, 255, 0.75);
      border-radius: 18px;
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 10px;
    }

    .mascot {
      font-size: 56px;
      filter: drop-shadow(0 8px 10px rgba(255, 122, 217, 0.2));
      animation: bounce 3s ease-in-out infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .sparkles {
      display: flex;
      gap: 6px;
      font-size: 14px;
      color: var(--primary-dark);
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
    }

    textarea,
    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 15px;
      outline: none;
      transition: border .2s, box-shadow .2s;
      background: rgba(255, 255, 255, 0.95);
    }

    textarea {
      min-height: 140px;
      resize: vertical;
    }

    textarea:focus,
    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(255, 122, 217, 0.2);
    }

    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 12px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: var(--muted);
    }

    button {
      background: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 18px;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      transition: transform .06s, background .2s;
      box-shadow: 0 12px 20px rgba(255, 122, 217, 0.25);
    }

    button:hover { background: var(--primary-dark); }
    button:active { transform: scale(0.98); }

    .ghost {
      background: rgba(255, 255, 255, 0.8);
      color: var(--secondary);
      border: 1px solid rgba(124, 92, 255, 0.2);
      box-shadow: none;
    }

    .status {
      font-size: 14px;
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #d1d5db;
      display: inline-block;
    }

    .dot.loading {
      background: var(--primary);
      animation: pulse 1s infinite ease-in-out;
    }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.6; }
      50% { transform: scale(1.5); opacity: 1; }
      100% { transform: scale(1); opacity: 0.6; }
    }

    pre {
      white-space: pre-wrap;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.7);
      padding: 16px;
      border-radius: 12px;
      min-height: 120px;
      font-size: 15px;
      line-height: 1.6;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    .meta {
      margin-top: 12px;
      padding: 12px;
      border: 1px dashed rgba(255, 122, 217, 0.4);
      border-radius: 12px;
      background: rgba(255, 240, 250, 0.7);
      font-size: 13px;
      color: var(--muted);
    }

    .pill-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .pill {
      border: 1px solid rgba(255, 255, 255, 0.9);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.95);
      font-size: 12px;
      color: var(--muted);
      cursor: pointer;
    }

    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
      margin-top: 12px;
    }

    .feature-card {
      background: rgba(255, 255, 255, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 12px 24px rgba(124, 92, 255, 0.08);
      display: grid;
      gap: 6px;
    }

    .feature-card span {
      font-size: 22px;
    }

    .feature-card strong {
      font-size: 14px;
    }

    .feature-card p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .style-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .style-chip {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 122, 217, 0.2);
      color: var(--primary-dark);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 13px;
      cursor: pointer;
    }

    .status-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .status-item {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(255, 255, 255, 0.9);
    }

    .status-item h4 {
      margin: 0 0 6px;
      font-size: 14px;
    }

    .status-item p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .footer {
      margin-top: 24px;
      text-align: center;
      color: var(--muted);
      font-size: 12px;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 18px;
      margin: 0 0 8px;
    }

    .section-subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .blueprint-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .blueprint-card {
      background: rgba(255, 255, 255, 0.88);
      border-radius: 16px;
      padding: 14px;
      border: 1px solid rgba(255, 255, 255, 0.9);
      display: grid;
      gap: 6px;
    }

    .blueprint-card h4 {
      margin: 0;
      font-size: 14px;
    }

    .blueprint-card p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.5;
    }

    .api-input {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .api-input input {
      flex: 1;
      min-width: 220px;
    }

    .action-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 12px;
    }

    .action-bar button {
      font-size: 14px;
    }

    .log-panel {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 14px;
      border: 1px dashed rgba(124, 92, 255, 0.3);
      padding: 12px;
      font-size: 12px;
      color: var(--muted);
      white-space: pre-wrap;
    }

    .form-hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <div class="bg-blobs">
    <div class="blob one"></div>
    <div class="blob two"></div>
    <div class="blob three"></div>
  </div>
  <div class="wrap">
    <div class="hero">
      <div>
        <h1>ğŸ’– æ—å¿—ç²ä»Šæ—¥å€¼ç­AIå°åŠ©æ‰‹</h1>
        <p>é»˜è®¤å¯çˆ±æ¨¡å¼ï¼Œä¸“æ³¨ 512MB è½»é‡è½åœ°ä¸æ¶æ„å‡çº§å»ºè®®ã€‚</p>
        <p class="muted">åç«¯åœ°å€ï¼š<code id="apiBase"></code></p>
        <div class="hero-tags">
          <span class="tag emphasis">é»˜è®¤å¯çˆ±æ¨¡å¼</span>
          <span class="tag">æ¶æ„å»ºè®®</span>
          <span class="tag">RAG èµ„æ–™æ£€ç´¢</span>
          <span class="tag">512MB è½»é‡è½åœ°</span>
          <span class="tag">æµå¼è¾“å‡º</span>
        </div>
      </div>
      <div class="hero-art">
        <div class="mascot">ğŸ§­ğŸ§ </div>
        <div class="sparkles">âœ¨ âš¡ï¸ ğŸ“ˆ âœ¨</div>
        <p class="muted">Render 512MB Â· è½»é‡å®æˆ˜</p>
      </div>
    </div>

    <div class="card">
      <label>å‡çº§èƒ½åŠ›æ€»è§ˆ</label>
      <div class="feature-grid">
        <div class="feature-card">
          <span>ğŸ§©</span>
          <strong>æ¶æ„å»ºè®®æ¨¡å¼</strong>
          <p>æŒ‰ã€Œæ ¸å¿ƒèƒ½åŠ› â†’ å…¸å‹ç”¨æ³• â†’ 512MB è½åœ° â†’ ä¸‹ä¸€æ­¥å‡çº§ã€è¾“å‡ºã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ”</span>
          <strong>è½»é‡ RAG æ£€ç´¢</strong>
          <p>å†…ç½® LangChain/RAG èµ„æ–™ï¼Œå¿«é€Ÿæ‹¼è£…ä¸Šä¸‹æ–‡ã€‚</p>
        </div>
        <div class="feature-card">
          <span>âš¡ï¸</span>
          <strong>æµå¼ä½“éªŒä¼˜åŒ–</strong>
          <p>é¦– token æ›´å¿«ï¼Œé€‚é… Render å…è´¹å®ä¾‹ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ¯</span>
          <strong>Router æ€è·¯æç¤º</strong>
          <p>ç®€å•é—®é¢˜èµ°è½»æ¨¡å‹ï¼Œå¤æ‚é—®é¢˜èµ°å¼ºæ¨¡å‹ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ§­</span>
          <strong>è½»é‡è§‚æµ‹é¢æ¿</strong>
          <p>è¯·æ±‚é‡ã€ç¼“å­˜å‘½ä¸­ã€å»¶è¿Ÿå¯è§†åŒ–ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ› ï¸</span>
          <strong>æŒ‡ä»¤ & å·¥å…·é¢„çƒ­</strong>
          <p>å¿«æ·å‘½ä»¤ + å®‰å…¨å·¥å…·ï¼Œä¾¿äºæ‰©å±• Agentã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ§ª</span>
          <strong>Provider æŠ½è±¡</strong>
          <p>åŒä¸€å¥—æ¥å£åˆ‡æ¢ OpenAI / Gemini / Anthropic / Ollamaã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ§·</span>
          <strong>Prompt ç»„ä»¶åŒ–</strong>
          <p>PromptTemplate + Messages å¯å¤ç”¨å¯ç‰ˆæœ¬åŒ–ã€‚</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">ğŸš€ å…¨éƒ¨å¯å‡çº§èƒ½åŠ›æ¸…å•ï¼ˆ512MB ä¼˜åŒ–å–å‘ï¼‰</h3>
      <p class="section-subtitle">é»˜è®¤å¯çˆ±æ¨¡å¼ä¹Ÿèƒ½åšé‡æ´»ï¼šå…ˆè½»é‡ã€å†è¿›é˜¶ï¼ŒæŒ‰ 512MB ç°å®çº¦æŸæ’åºã€‚</p>
      <div class="feature-grid">
        <div class="feature-card">
          <span>ğŸ§ </span>
          <strong>çœŸå®å‘é‡æ•°æ®åº“ RAG</strong>
          <p>ç¦»çº¿ embedding + å¤–éƒ¨å‘é‡åº“æ£€ç´¢ + rerankï¼Œé™ä½å†…å­˜å¸¸é©»ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸª</span>
          <strong>é•¿è®°å¿† / é•¿æœŸå¯¹è¯å­˜å‚¨</strong>
          <p>çŸ­æœŸçª—å£è®°å¿† + é•¿æœŸå‘é‡å¬å›ï¼Œå»ºè®®å¤–éƒ¨å­˜å‚¨ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸŒˆ</span>
          <strong>å¤š Provider å¯ç”¨</strong>
          <p>æ‰“é€š OpenAI/Anthropic/Ollamaï¼Œè‡ªåŠ¨å›é€€æ§æˆæœ¬ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ“ˆ</span>
          <strong>å¯è§‚æµ‹æ€§å¢å¼º</strong>
          <p>è¡¥é½ trace / token / latency æŒ‡æ ‡ï¼Œè½»é‡æ—¥å¿—å…ˆè¡Œã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ§­</span>
          <strong>Router æ›´ç²¾ç»†</strong>
          <p>ç”¨åˆ†ç±»å™¨æˆ–è´¨é‡è¯„ä¼°ä¼˜åŒ–è·¯ç”±ï¼Œç¨³å®šä¸”çœé’±ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ”</span>
          <strong>å®‰å…¨ä¸æ²»ç†</strong>
          <p>API Key æ ¡éªŒã€é™æµã€å®¡è®¡æ—¥å¿—ã€CORS ç™½åå•ç®¡ç†ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ¤–</span>
          <strong>å·¥å…·æ‰©å±•ä¸ Agent åŒ–</strong>
          <p>æ¥å…¥ HTTP/DB/ä»»åŠ¡ç¼–æ’ï¼Œå¤šæ­¥ä»»åŠ¡è‡ªåŠ¨å†³ç­–ã€‚</p>
        </div>
        <div class="feature-card">
          <span>ğŸ›ï¸</span>
          <strong>å‰ç«¯å¯é…ç½®ä½“éªŒ</strong>
          <p>ç»“æœå¯¹æ¯”ã€Prompt ç‰ˆæœ¬ç®¡ç†ã€å¯è§†åŒ–è¯„ä¼°ã€‚</p>
        </div>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">ğŸ§± æ¶æ„å‡çº§è“å›¾</h3>
      <p class="section-subtitle">æ ¹æ® LangChain èƒ½åŠ›ä¸ 512MB é™åˆ¶æ¢³ç†çš„è½åœ°è·¯çº¿å›¾ã€‚</p>
      <p class="section-subtitle">æ ¸å¿ƒèƒ½åŠ›</p>
      <div id="blueprintCore" class="blueprint-grid"></div>
      <p class="section-subtitle">å…¸å‹ç”¨æ³•</p>
      <div id="blueprintUse" class="blueprint-grid"></div>
      <p class="section-subtitle">Render 512MB å»ºè®®</p>
      <div id="blueprintRender" class="blueprint-grid"></div>
      <p class="section-subtitle">ä¸‹ä¸€æ­¥å‡çº§</p>
      <div id="blueprintNext" class="blueprint-grid"></div>
      <div class="pill-list" id="blueprintTips"></div>
    </div>

    <div class="card">
      <label for="q">ä½ çš„é—®é¢˜</label>
      <textarea id="q" placeholder="ä¾‹å¦‚ï¼šæŒ‰ç»“æ„è¯´æ˜ LangChain æ ¸å¿ƒèƒ½åŠ›ä¸ 512MB è½åœ°å»ºè®®"></textarea>

      <div class="api-input">
        <label for="apiInput">API åœ°å€</label>
        <input id="apiInput" type="text" />
        <button class="ghost" onclick="saveApiBase()">ä¿å­˜</button>
      </div>

      <div class="grid">
        <div>
          <label for="session">ä¼šè¯ IDï¼ˆç”¨äºå¤šè½®ä¸Šä¸‹æ–‡ï¼‰</label>
          <input id="session" type="text" />
        </div>
        <div>
          <label for="prompt">è‡ªå®šä¹‰é£æ ¼æç¤ºè¯</label>
          <input id="prompt" type="text" placeholder="ä¾‹å¦‚ï¼šè¯·ç”¨ä¸“ä¸šä½†ç®€æ´çš„è¯­æ°”å›ç­”" />
        </div>
        <div>
          <label for="attachment">ä¸Šä¼ é™„ä»¶ï¼ˆå›¾ç‰‡/éŸ³é¢‘/æ–‡ä»¶ï¼‰</label>
          <input id="attachment" type="file" />
          <p class="form-hint">å°†è‡ªåŠ¨å¯ç”¨å¤šæ¨¡æ€æ‘˜è¦ï¼Œåˆå¹¶åˆ°å›ç­”ä¸Šä¸‹æ–‡ã€‚</p>
        </div>
      </div>

      <div class="row">
        <label class="toggle"><input id="stream" type="checkbox" checked /> æµå¼è¾“å‡º</label>
        <label class="toggle"><input id="meta" type="checkbox" /> æ˜¾ç¤ºå…ƒä¿¡æ¯</label>
        <label class="toggle"><input id="advisor" type="checkbox" checked /> æ¶æ„å»ºè®®æ¨¡å¼</label>
        <label class="toggle"><input id="rag" type="checkbox" checked /> RAG èµ„æ–™å¢å¼º</label>
        <label class="toggle"><input id="enableTools" type="checkbox" checked /> å·¥å…·è°ƒç”¨</label>
        <label class="toggle"><input id="enableRouter" type="checkbox" checked /> Router è‡ªåŠ¨è·¯ç”±</label>
        <button onclick="ask()">æé—®</button>
        <button class="ghost" onclick="clearSession()">æ¸…ç©ºä¼šè¯</button>
        <span class="status">
          <span id="dot" class="dot"></span>
          <span id="statusText">ç­‰å¾…è¾“å…¥</span>
        </span>
      </div>
      <div class="action-bar">
        <button class="ghost" onclick="fillAdvisorPrompt()">ä¸€é”®ç”Ÿæˆå‡çº§å»ºè®®æç¤ºè¯</button>
        <button class="ghost" onclick="fillRagPrompt()">ä¸€é”® RAG èµ„æ–™å‹æé—®</button>
      </div>
      <p class="muted">æç¤ºï¼šå¼€å¯â€œå…ƒä¿¡æ¯â€æ—¶ä¼šè‡ªåŠ¨å…³é—­æµå¼è¾“å‡ºï¼›æ¶æ„å»ºè®®æ¨¡å¼ä¼šæŒ‰å›ºå®šç»“æ„è¾“å‡ºã€‚</p>
    </div>

    <div class="card">
      <h3 class="section-title">ğŸ“ å¤šæ¨¡æ€é™„ä»¶ï¼ˆå›¾ç‰‡ / éŸ³é¢‘ / æ–‡ä»¶ï¼‰</h3>
      <p class="section-subtitle">ä¸Šä¼ åå…ˆé¢„è§ˆç»“æ„åŒ–æ‘˜è¦ï¼Œå†å¸¦ç€æ‘˜è¦å‘é—®ã€‚</p>
      <div class="grid">
        <div>
          <label for="attachment">é€‰æ‹©é™„ä»¶</label>
          <input id="attachment" type="file" />
          <p class="form-hint">æ”¯æŒå›¾ç‰‡ã€éŸ³é¢‘ä¸é€šç”¨æ–‡ä»¶ï¼ˆ<= 6MBï¼‰ã€‚</p>
        </div>
        <div>
          <label>é™„ä»¶æ‘˜è¦</label>
          <pre id="attachmentPreview">å°šæœªä¸Šä¼ </pre>
        </div>
      </div>
      <div class="row">
        <button class="ghost" onclick="previewAttachment()">é¢„è§ˆé™„ä»¶æ‘˜è¦</button>
      </div>
    </div>

    <div class="card">
      <h3 class="section-title">ğŸ§  LLM æ§åˆ¶é¢æ¿</h3>
      <p class="section-subtitle">ç»Ÿä¸€é…ç½® Providerã€æ¸©åº¦ã€tokenã€å›é€€ä¸é‡è¯•ç­–ç•¥ã€‚</p>
      <div class="grid">
        <div>
          <label for="provider">Provider</label>
          <select id="provider"></select>
          <p class="form-hint">å»ºè®®ä½¿ç”¨ autoï¼Œç”± Router è‡ªåŠ¨é€‰æ‹©ã€‚</p>
        </div>
        <div>
          <label for="temperature">Temperature</label>
          <input id="temperature" type="number" min="0" max="2" step="0.1" value="0.7" />
        </div>
        <div>
          <label for="maxTokens">Max tokens</label>
          <input id="maxTokens" type="number" min="128" max="4096" step="128" value="2048" />
        </div>
        <div>
          <label for="topP">Top-p</label>
          <input id="topP" type="number" min="0" max="1" step="0.05" value="1" />
        </div>
        <div>
          <label for="topK">Top-k</label>
          <input id="topK" type="number" min="1" max="40" step="1" value="1" />
        </div>
        <div>
          <label for="retries">é‡è¯•æ¬¡æ•°</label>
          <input id="retries" type="number" min="1" max="3" step="1" value="1" />
        </div>
      </div>
      <div class="row">
        <label for="fallback" style="flex:1">å›é€€ Providerï¼ˆé€—å·åˆ†éš”ï¼‰</label>
        <input id="fallback" type="text" placeholder="ä¾‹å¦‚ï¼šopenai,anthropic" style="flex:2" />
      </div>
    </div>

    <div class="card">
      <label>ä¸€é”®é¡¾é—®é£æ ¼</label>
      <div class="style-chips">
        <button class="style-chip" data-prompt="è¯·ç”¨ä¸“ä¸šã€ç®€æ´çš„é¡¾é—®è¯­æ°”å›ç­”ï¼Œç»™å‡ºå¯æ‰§è¡Œè¦ç‚¹ã€‚">ä¸“ä¸šé¡¾é—®</button>
        <button class="style-chip" data-prompt="è¯·ç”¨è¦ç‚¹æ¸…å•è¾“å‡ºï¼Œæ¯æ®µä¸è¶…è¿‡ 3 è¡Œã€‚">æç®€è¦ç‚¹</button>
        <button class="style-chip" data-prompt="è¯·ä»¥è·¯çº¿å›¾å½¢å¼å›ç­”ï¼Œåˆ—å‡ºçŸ­ä¸­é•¿æœŸè¡ŒåŠ¨ã€‚">è·¯çº¿å›¾</button>
        <button class="style-chip" data-prompt="è¯·å¼ºè°ƒæˆæœ¬ä¸æ€§èƒ½å–èˆï¼Œç»™å‡º 512MB ä¼˜å…ˆçº§å»ºè®®ã€‚">æˆæœ¬ä¼˜å…ˆ</button>
      </div>
      <p class="muted">ç‚¹å‡»åä¼šè‡ªåŠ¨å¡«å……ã€Œè‡ªå®šä¹‰é£æ ¼æç¤ºè¯ã€ã€‚</p>
    </div>

    <div class="card">
      <label>æé€ŸæŒ‡ä»¤ï¼ˆåç«¯æœ¬åœ°æ‰§è¡Œï¼‰</label>
      <div id="commands" class="pill-list"></div>
      <p class="muted">ç‚¹å‡»æŒ‡ä»¤å¯è‡ªåŠ¨å¡«å……åˆ°è¾“å…¥æ¡†ã€‚</p>
    </div>

    <div class="card">
      <label>é“¾å¼æµç¨‹ï¼ˆChainsï¼‰</label>
      <div id="chainSteps" class="pill-list"></div>
      <p class="muted">é¢„å¤„ç† â†’ å·¥å…· â†’ æ£€ç´¢ â†’ ç”Ÿæˆ â†’ åå¤„ç†ï¼Œå¯æ‰©å±•åˆ†æ”¯ä¸å¹¶è¡Œã€‚</p>
    </div>

    <div class="card">
      <label>è½»é‡è§‚æµ‹é¢æ¿</label>
      <div class="status-panel">
        <div class="status-item">
          <h4>è¯·æ±‚æ€»é‡</h4>
          <p id="statRequests">åŠ è½½ä¸­...</p>
        </div>
        <div class="status-item">
          <h4>ç¼“å­˜å‘½ä¸­</h4>
          <p id="statCache">åŠ è½½ä¸­...</p>
        </div>
        <div class="status-item">
          <h4>ä¼šè¯æ•°</h4>
          <p id="statSessions">åŠ è½½ä¸­...</p>
        </div>
        <div class="status-item">
          <h4>ç­–ç•¥æç¤º</h4>
          <p>ä½æˆæœ¬ä¼˜å…ˆï¼šRAG + streaming â†’ Router â†’ è½»é‡å·¥å…·ã€‚</p>
        </div>
      </div>
      <div class="log-panel" id="observabilityLog">ç­‰å¾…åˆ·æ–°è§‚æµ‹æ•°æ®...</div>
    </div>

    <div class="card">
      <h3 class="section-title">ğŸ›°ï¸ è¿è¥æ§åˆ¶å°ï¼ˆè¶…è½»é‡ 512MB å‹å¥½ï¼‰</h3>
      <p class="section-subtitle">ä¸€é”®æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€ã€è¿‘æœŸè¯·æ±‚ã€ç¼“å­˜ä¸ä¼šè¯ï¼Œè¿è¥æ›´ç¨³ã€‚</p>
      <div class="action-bar">
        <button class="ghost" onclick="loadSystemInfo()">åˆ·æ–°ç³»ç»ŸçŠ¶æ€</button>
        <button class="ghost" onclick="loadObservability()">æ‹‰å–æœ€è¿‘è¯·æ±‚</button>
        <button class="ghost" onclick="clearObservability()">æ¸…ç©ºè¯·æ±‚æ—¥å¿—</button>
        <button class="ghost" onclick="clearCache()">æ¸…ç©ºå›ç­”ç¼“å­˜</button>
      </div>
      <div class="grid">
        <div>
          <label>ç³»ç»ŸçŠ¶æ€</label>
          <pre id="systemInfo">ç­‰å¾…æŸ¥è¯¢...</pre>
        </div>
        <div>
          <label>æœ€è¿‘è¯·æ±‚æ—¥å¿—</label>
          <pre id="observabilityEvents">ç­‰å¾…æŸ¥è¯¢...</pre>
        </div>
      </div>
      <p class="muted">æç¤ºï¼šæ—¥å¿—ä¸ç¼“å­˜å‡ä¸ºå†…å­˜çº§åˆ«ï¼Œé‡å¯åä¼šæ¸…ç©ºã€‚</p>
    </div>

    <div class="card">
      <label>å›ç­”</label>
      <pre id="ans">è¿™é‡Œä¼šæ˜¾ç¤º AI çš„å›ç­”ï½</pre>
      <div id="metaPanel" class="meta">å…ƒä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚</div>
    </div>

    <div class="footer">Made with â¤ï¸ by iehmltym</div>
  </div>

  <script>
    const DEFAULT_API_BASE = "https://myagent-mhrq.onrender.com";
    let apiBase = localStorage.getItem("api_base") || DEFAULT_API_BASE;
    if (window.location.hostname === "myagent-mhrq.onrender.com") {
      apiBase = window.location.origin;
    }
    document.getElementById("apiBase").textContent = apiBase;
    document.getElementById("apiInput").value = apiBase;

    const sessionInput = document.getElementById("session");
    const promptInput = document.getElementById("prompt");
    const attachmentInput = document.getElementById("attachment");
    const styleChips = document.querySelectorAll(".style-chip");

    function loadSessionId() {
      const stored = localStorage.getItem("session_id");
      if (stored) {
        sessionInput.value = stored;
        return;
      }
      const generated = `web-${crypto.randomUUID()}`;
      localStorage.setItem("session_id", generated);
      sessionInput.value = generated;
    }

    function saveApiBase() {
      const input = document.getElementById("apiInput");
      const nextBase = input.value.trim();
      if (!nextBase) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ API åœ°å€");
        return;
      }
      apiBase = nextBase;
      localStorage.setItem("api_base", apiBase);
      document.getElementById("apiBase").textContent = apiBase;
      loadCommands();
      loadBlueprint();
      loadStats();
    }

    async function loadCommands() {
      try {
        const resp = await fetch(`${apiBase}/features`);
        if (!resp.ok) throw new Error("æ— æ³•è·å–ç‰¹æ€§åˆ—è¡¨");
        const data = await resp.json();
        const container = document.getElementById("commands");
        container.innerHTML = "";
        data.commands.forEach((item) => {
          const pill = document.createElement("button");
          pill.type = "button";
          pill.className = "pill";
          pill.textContent = `${item.cmd} Â· ${item.desc}`;
          pill.addEventListener("click", () => {
            document.getElementById("q").value = item.cmd;
          });
          container.appendChild(pill);
        });
        const providerSelect = document.getElementById("provider");
        providerSelect.innerHTML = "";
        data.providers.forEach((provider) => {
          const option = document.createElement("option");
          option.value = provider.id;
          option.textContent = `${provider.id} Â· ${provider.desc}`;
          providerSelect.appendChild(option);
        });
        providerSelect.value = "auto";
        const chainSteps = document.getElementById("chainSteps");
        chainSteps.innerHTML = "";
        (data.chains?.steps || []).forEach((step) => {
          const pill = document.createElement("div");
          pill.className = "pill";
          pill.textContent = step;
          chainSteps.appendChild(pill);
        });
      } catch (e) {
        document.getElementById("commands").textContent = "å‘½ä»¤åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    function renderBlueprintSection(containerId, title, items) {
      const container = document.getElementById(containerId);
      container.innerHTML = "";
      if (!items || items.length === 0) return;
      items.forEach((item) => {
        const card = document.createElement("div");
        card.className = "blueprint-card";
        card.innerHTML = `<h4>${item.title}</h4><p>${item.content}</p>`;
        container.appendChild(card);
      });
    }

    async function loadBlueprint() {
      try {
        const resp = await fetch(`${apiBase}/blueprint`);
        if (!resp.ok) throw new Error("æ— æ³•è·å–è“å›¾æ•°æ®");
        const data = await resp.json();
        renderBlueprintSection("blueprintCore", "æ ¸å¿ƒèƒ½åŠ›", data.sections.core);
        renderBlueprintSection("blueprintUse", "å…¸å‹ç”¨æ³•", data.sections.use);
        renderBlueprintSection("blueprintRender", "Render 512MB", data.sections.render);
        renderBlueprintSection("blueprintNext", "ä¸‹ä¸€æ­¥å‡çº§", data.sections.next);
        const tips = document.getElementById("blueprintTips");
        tips.innerHTML = "";
        data.tips.forEach((tip) => {
          const pill = document.createElement("div");
          pill.className = "pill";
          pill.textContent = tip;
          tips.appendChild(pill);
        });
      } catch (e) {
        document.getElementById("blueprintCore").textContent = "è“å›¾åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    async function loadStats() {
      try {
        const resp = await fetch(`${apiBase}/stats`);
        if (!resp.ok) throw new Error("æ— æ³•è·å–ç»Ÿè®¡æ•°æ®");
        const data = await resp.json();
        document.getElementById("statRequests").textContent =
          `æ€»é‡ ${data.requests.total} Â· LLM ${data.requests.llm} Â· è§„åˆ™ ${data.requests.rule}`;
        document.getElementById("statCache").textContent =
          `å‘½ä¸­ ${data.cache.hits} / å¤±æ•ˆ ${data.cache.misses} Â· ç¼“å­˜å¤§å° ${data.cache.size}`;
        document.getElementById("statSessions").textContent =
          `æ´»è·ƒ ${data.sessions.active} / ä¸Šé™ ${data.sessions.max}`;
        document.getElementById("observabilityLog").textContent =
          `æœ€è¿‘è¯·æ±‚ç»Ÿè®¡ï¼šLLM ${data.requests.llm} æ¬¡ï¼Œè§„åˆ™å‘½ä¸­ ${data.requests.rule} æ¬¡ï¼Œç¼“å­˜å‘½ä¸­ ${data.requests.cache} æ¬¡ã€‚`;
      } catch (e) {
        document.getElementById("observabilityLog").textContent = "è§‚æµ‹æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    async function loadSystemInfo() {
      const panel = document.getElementById("systemInfo");
      panel.textContent = "åŠ è½½ä¸­...";
      try {
        const resp = await fetch(`${apiBase}/system`);
        if (!resp.ok) throw new Error("æ— æ³•è·å–ç³»ç»ŸçŠ¶æ€");
        const data = await resp.json();
        panel.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        panel.textContent = "ç³»ç»ŸçŠ¶æ€è·å–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    async function loadObservability() {
      const panel = document.getElementById("observabilityEvents");
      panel.textContent = "åŠ è½½ä¸­...";
      try {
        const resp = await fetch(`${apiBase}/observability/logs?limit=20`);
        if (!resp.ok) throw new Error("æ— æ³•è·å–è§‚æµ‹æ—¥å¿—");
        const data = await resp.json();
        panel.textContent = JSON.stringify(data.events || [], null, 2);
      } catch (e) {
        panel.textContent = "è§‚æµ‹æ—¥å¿—è·å–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    async function clearObservability() {
      const panel = document.getElementById("observabilityEvents");
      panel.textContent = "æ¸…ç©ºä¸­...";
      try {
        const resp = await fetch(`${apiBase}/observability/clear`, { method: "POST" });
        if (!resp.ok) throw new Error("æ— æ³•æ¸…ç©ºæ—¥å¿—");
        const data = await resp.json();
        panel.textContent = `å·²æ¸…ç©º ${data.cleared} æ¡æ—¥å¿—ã€‚`;
      } catch (e) {
        panel.textContent = "æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    async function clearCache() {
      const panel = document.getElementById("systemInfo");
      panel.textContent = "æ¸…ç©ºä¸­...";
      try {
        const resp = await fetch(`${apiBase}/cache/clear`, { method: "POST" });
        if (!resp.ok) throw new Error("æ— æ³•æ¸…ç©ºç¼“å­˜");
        const data = await resp.json();
        panel.textContent = `ç¼“å­˜å·²æ¸…ç©ºï¼Œæ¸…é™¤ ${data.cleared} æ¡ï¼Œå‰©ä½™ ${data.cache_size}ã€‚`;
      } catch (e) {
        panel.textContent = "æ¸…ç©ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    }

    async function clearSession() {
      const sessionId = sessionInput.value.trim();
      if (!sessionId) {
        alert("è¯·å…ˆå¡«å†™ä¼šè¯ ID");
        return;
      }
      await fetch(`${apiBase}/session/clear`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ session_id: sessionId })
      });
      alert("ä¼šè¯å·²æ¸…ç©ºï¼ˆæˆ–ä¸å­˜åœ¨ï¼‰");
    }

    async function previewAttachment() {
      const preview = document.getElementById("attachmentPreview");
      const file = attachmentInput?.files?.[0];
      if (!file) {
        preview.textContent = "è¯·å…ˆé€‰æ‹©é™„ä»¶ã€‚";
        return;
      }
      preview.textContent = "åˆ†æä¸­...";
      let endpoint = "/files/describe";
      if (file.type.startsWith("image/")) {
        endpoint = "/images/describe";
      } else if (file.type.startsWith("audio/")) {
        endpoint = "/audio/describe";
      }
      const form = new FormData();
      form.append("file", file);
      try {
        const resp = await fetch(`${apiBase}${endpoint}`, { method: "POST", body: form });
        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
        const data = await resp.json();
        preview.textContent = JSON.stringify(data, null, 2);
      } catch (e) {
        preview.textContent = `è§£æå¤±è´¥ï¼š${e.message}`;
      }
    }

    function fillAdvisorPrompt() {
      document.getElementById("q").value =
        "æŒ‰â€œæ ¸å¿ƒèƒ½åŠ›ï¼ˆLangChain èƒ½åšä»€ä¹ˆï¼‰â†’ å…¸å‹ç”¨æ³• â†’ Render 512MB è½åœ°å»ºè®® â†’ ä¸‹ä¸€æ­¥å‡çº§â€çš„ç»“æ„è¯´æ˜ã€‚";
    }

    function fillRagPrompt() {
      document.getElementById("q").value =
        "ç»“åˆ RAGã€Agentã€Routerã€Streaming çš„å·¥ç¨‹ä»·å€¼ï¼Œç»™å‡ºè½åœ°ä¼˜å…ˆçº§å’Œ 512MB å®ä¾‹æ³¨æ„äº‹é¡¹ã€‚";
    }

    async function ask() {
      const question = document.getElementById("q").value.trim();
      const statusText = document.getElementById("statusText");
      const dot = document.getElementById("dot");
      const ans = document.getElementById("ans");
      const metaPanel = document.getElementById("metaPanel");

      if (!question) {
        ans.textContent = "è¯·å…ˆè¾“å…¥é—®é¢˜å“¦ï½";
        return;
      }

      const streamToggle = document.getElementById("stream");
      const metaToggle = document.getElementById("meta");
      const advisorToggle = document.getElementById("advisor");
      const ragToggle = document.getElementById("rag");
      const toolsToggle = document.getElementById("enableTools");
      const routerToggle = document.getElementById("enableRouter");
      const attachment = attachmentInput?.files?.[0] || null;
      let stream = streamToggle.checked;
      const includeMeta = metaToggle.checked;
      if (includeMeta) {
        stream = false;
      }
      let mode = null;
      if (advisorToggle.checked) {
        mode = "advisor";
      } else if (ragToggle.checked) {
        mode = "rag";
      }

      const payload = {
        question,
        stream,
        include_meta: includeMeta,
        session_id: sessionInput.value.trim() || null,
        system_prompt: promptInput.value.trim() || null,
        mode,
        provider: document.getElementById("provider").value || "auto",
        temperature: parseFloat(document.getElementById("temperature").value || "0.7"),
        max_output_tokens: parseInt(document.getElementById("maxTokens").value || "2048", 10),
        top_p: parseFloat(document.getElementById("topP").value || "1"),
        top_k: parseInt(document.getElementById("topK").value || "1", 10),
        retries: parseInt(document.getElementById("retries").value || "1", 10),
        fallback_providers: document.getElementById("fallback").value
          .split(",")
          .map((item) => item.trim())
          .filter(Boolean),
        enable_tools: toolsToggle.checked,
        enable_router: routerToggle.checked
      };

      statusText.textContent = "è¯·æ±‚ä¸­...";
      dot.classList.add("loading");
      ans.textContent = "";
      metaPanel.textContent = "å…ƒä¿¡æ¯ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œã€‚";

      try {
        let resp;
        if (attachment) {
          const form = new FormData();
          Object.entries(payload).forEach(([key, value]) => {
            if (value === null || value === undefined) return;
            if (Array.isArray(value)) {
              form.append(key, value.join(","));
            } else {
              form.append(key, String(value));
            }
          });
          form.append("file", attachment);
          resp = await fetch(`${apiBase}/ask/multimodal`, {
            method: "POST",
            body: form
          });
        } else {
          resp = await fetch(`${apiBase}/ask`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
        }

        if (!resp.ok) {
          const t = await resp.text();
          throw new Error(`HTTP ${resp.status}: ${t}`);
        }

        if (stream) {
          if (!resp.body) {
            ans.textContent = await resp.text();
          } else {
            const reader = resp.body.getReader();
            const decoder = new TextDecoder("utf-8");
            ans.textContent = "";
            while (true) {
              const { value, done } = await reader.read();
              if (done) break;
              ans.textContent += decoder.decode(value, { stream: true });
            }
          }
        } else {
          const data = await resp.json();
          ans.textContent = data.answer ?? "(åç«¯æ²¡æœ‰è¿”å› answer å­—æ®µ)";
          if (data.meta) {
            const ragInfo = data.meta.rag_docs ? ` | RAG æ–‡æ¡£ï¼š${data.meta.rag_docs.join("ã€")}` : "";
            const providerInfo = data.meta.provider ? ` | Providerï¼š${data.meta.provider}` : "";
            const routeInfo = data.meta.route_reason ? ` | è·¯ç”±ï¼š${data.meta.route_reason}` : "";
            const attachmentInfo = data.meta.attachment
              ? ` | é™„ä»¶ï¼š${data.meta.attachment.filename} (${data.meta.attachment.size_bytes}B)`
              : "";
            metaPanel.textContent =
              `æ¥æºï¼š${data.meta.source} | ç¼“å­˜å‘½ä¸­ï¼š${data.meta.cache_hit} | å»¶è¿Ÿï¼š${data.meta.latency_ms}ms${ragInfo}${providerInfo}${routeInfo}${attachmentInfo}`;
          }
        }

        statusText.textContent = "å®Œæˆ âœ…";
      } catch (e) {
        statusText.textContent = "å¤±è´¥ âŒ";
        ans.textContent =
          "è¯·æ±‚å¤±è´¥ï¼š\n" + e.message +
          "\n\nå¦‚æœä½ åœ¨æµè§ˆå™¨æ§åˆ¶å°çœ‹åˆ° CORS æŠ¥é”™ï¼Œéœ€è¦åç«¯æ”¾è¡Œ https://iehmltym.github.io";
      } finally {
        dot.classList.remove("loading");
      }
    }

    loadSessionId();
    loadCommands();
    loadBlueprint();
    loadStats();
    loadSystemInfo();
    loadObservability();

    styleChips.forEach((chip) => {
      chip.addEventListener("click", () => {
        promptInput.value = chip.dataset.prompt;
        promptInput.focus();
      });
    });
  </script>
</body>
</html>
